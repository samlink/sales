import{notifier}from"../parts/notifier.mjs";var code=document.querySelector("#user-code").textContent,login_show=document.querySelector("#login-form"),logon_show=document.querySelector("#logon-form"),login=document.querySelector("#login"),logon=document.querySelector("#logon");document.querySelector("#login a").addEventListener("click",(function(e){e.preventDefault(),login_show.style.display="block",logon_show.style.display="none",login.style.display="none",logon.style.display="block",login_show.querySelectorAll("input")[0].focus()})),document.querySelector("#logon a").addEventListener("click",(function(e){e.preventDefault(),logon_show.style.display="block",login_show.style.display="none",login.style.display="block",logon.style.display="none",logon_show.querySelectorAll("input")[0].focus()})),document.querySelector("#logon-button").addEventListener("click",(function(event){event.preventDefault();var logon_pass=document.querySelector("#logon-pass").value.trim(),logon_pass2=document.querySelector("#logon-pass2").value.trim(),name=document.querySelector("#logon-name").value.trim();if(""==name||""==logon_pass||""==logon_pass2)return notifier.show("用户名或密码不能为空","danger"),!1;if(logon_pass!=logon_pass2)return notifier.show("两次输入的密码不同","danger"),!1;var user={name:name,password:logon_pass};fetch(`/${code}/logon`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(user)}).then((res=>res.json())).then((data=>{0!=data?notifier.show("注册完成，等待确认","info",6e3):notifier.show("该用户名已存在","danger")}))})),document.querySelector("#login-button").addEventListener("click",(function(event){event.preventDefault();var name=document.querySelector("#login-name").value.trim(),login_pass=document.querySelector("#login-pass").value.trim();if(""==name||""==login_pass)return notifier.show("用户名或密码不能为空","danger"),!1;var user={name:name,password:login_pass};fetch(`/${code}/login`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(user)}).then((res=>res.json())).then((data=>{-1==data?notifier.show("用户不存在","danger"):-2==data?notifier.show("等待管理员确认","warning"):0!=data&&data<6?(notifier.show("密码错误","danger"),setTimeout((()=>notifier.show("还有 "+data+" 次机会","warning")),500)):0==data||6==data?notifier.show("用户已被锁定","danger"):window.location=`/${code}/`}))})),document.querySelector("#forget-pass").addEventListener("click",(function(){let name=document.querySelector("#login-name").value.trim();if(""==name)return notifier.show("用户名不能为空","danger"),!1;var user={name:name,password:""};fetch(`/${code}/forget_pass`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(user)}).then((res=>res.json())).then((data=>{-1==data?notifier.show("用户不存在或待确认","danger"):-2==data?notifier.show("用户没有预留手机号","danger"):-3==data?notifier.show("找回密码机会已用完","danger"):(notifier.show("新密码已发送至预留手机号","success"),setTimeout((()=>notifier.show("还有 "+data+" 次找回密码的机会","info")),500))}))}));