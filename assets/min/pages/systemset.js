import{padZero}from"../parts/tools.mjs";import{notifier}from"../parts/notifier.mjs";document.querySelector("#function-set .nav-icon").classList.add("show-chosed"),document.querySelector("#function-set .menu-text").classList.add("show-chosed");const price=3.685972,mount=368.5972,year="2021",month="03",day="04",num="81";var edit=0;let price_select=document.querySelector("#price-select"),mount_select=document.querySelector("#mount-select"),date_select=document.querySelector("#date-select"),position_select=document.querySelector("#position-select"),spliter_check=document.querySelector("#spliter-check"),date_example=document.querySelector("#example-dh");function edit_change(){edit=1,document.querySelector("#sumit-button").disabled=!1}function change_dh(){let date,date_value=date_select.value,position_value=Number(position_select.value),spliter=spliter_check.checked?"-":"";date="日"==date_value?`XS2021${spliter}03${spliter}04${spliter}`:"月"==date_value?`XS2021${spliter}03${spliter}`:"年"==date_value?`XS2021${spliter}`:"XS";let pad_num=padZero(num,position_value);document.querySelector("#example-dh").textContent=` ${date}${pad_num}`}fetch(`/${code}/fetch_system`).then((response=>response.json())).then((data=>{let system=data.split(",");price_select.value=system[0],mount_select.value=system[1],date_select.value=system[2],position_select.value=system[3],spliter_check.checked="true"==system[4],document.querySelector("#example-price").textContent=price.toFixed(Number(price_select.value)),document.querySelector("#example-mount").textContent=mount.toFixed(Number(mount_select.value)),change_dh()})),price_select.addEventListener("change",(function(){document.querySelector("#example-price").textContent=price.toFixed(Number(this.value)),edit_change()})),mount_select.addEventListener("change",(function(){document.querySelector("#example-mount").textContent=mount.toFixed(Number(this.value)),edit_change()})),date_select.addEventListener("change",(function(){edit_change(),change_dh()})),position_select.addEventListener("change",(function(){edit_change(),change_dh()})),spliter_check.addEventListener("change",(function(){edit_change(),change_dh()})),document.querySelector("#sumit-button").addEventListener("click",(function(){let data=`${price_select.value},${mount_select.value},${date_select.value},${position_select.value},${spliter_check.checked},${date_example.textContent.trim()}`;fetch(`/${code}/update_system`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then((response=>response.json())).then((data=>{-1!=data?(edit=0,notifier.show("修改成功","success")):notifier.show("权限不够，操作失败","danger")}))})),window.onbeforeunload=function(e){1==edit&&((e=window.event||e).returnValue="编辑未保存提醒")};