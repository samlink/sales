import{table_init,fetch_table}from"../parts/table.mjs";import{notifier}from"../parts/notifier.mjs";import{AutoInput}from"../parts/autocomplete.mjs";import{SPLITER,getHeight}from"../parts/tools.mjs";document.querySelector("#customers .nav-icon").classList.add("show-chosed"),document.querySelector("#customers .menu-text").classList.add("show-chosed");let get_height=getHeight()-138,row_num=Math.floor(get_height/30);laydate.render({elem:"#search-date1",showBottom:!1}),laydate.render({elem:"#search-date2",showBottom:!1});let cate=document.querySelector("#auto_cate"),auto_comp=new AutoInput(document.querySelector("#search-customer"),cate,`/${code}/customer_auto`,(()=>{}));auto_comp.init();let blank_rows="";for(let i=0;i<row_num;i++)blank_rows+=blank_row_fn();document.querySelector(".table-container tbody").innerHTML=blank_rows;let init_data={container:".table-container",url:`/${code}/fetch_business`,post_data:{id:"",name:"",sort:"单号 DESC",rec:row_num},edit:!1,header_names:{"日期":"日期","单号":"单号","类别":"documents.类别","单据金额":"应结金额","商品名称":"node_name","规格型号":"规格型号","单位":"单位","价格":"单价","数量":"abs(数量)","备注":"documents.备注"},row_fn:row_fn,blank_row_fn:blank_row_fn};function row_fn(tr){let row=tr.split(SPLITER),num=document.querySelector("#num_position").textContent.split(","),center="style='text-align:center'",right="style='text-align:right'";return`<tr><td ${center}>${row[0]}</td><td ${center}>${row[1]}</td><td>${row[2]}</td><td ${center}>${row[3]}</td>\n            <td ${right}>${Number(row[4]).toFixed(num[1])}</td><td>${row[5]}</td><td>${row[6]}</td><td ${center}>${row[7]}</td>\n            <td ${right}>${Number(row[8]).toFixed(num[0])}</td><td ${right}>${row[9]}</td><td>${row[10]}</td></tr>`}function blank_row_fn(){return"<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>"}document.querySelector("#checkbox-fields").addEventListener("click",(function(){this.checked?document.querySelector("#search-fields").disabled=!1:document.querySelector("#search-fields").disabled=!0})),document.querySelector("#checkbox-date").addEventListener("click",(function(){this.checked?(document.querySelector("#search-date1").disabled=!1,document.querySelector("#search-date2").disabled=!1):(document.querySelector("#search-date1").disabled=!0,document.querySelector("#search-date2").disabled=!0)})),document.querySelector("#serach-button").addEventListener("click",(function(){let customer=document.querySelector("#search-customer").value;if(!customer)return void notifier.show("客户供应商不能为空","danger");let check_fields=document.querySelector("#checkbox-fields").checked,check_date=document.querySelector("#checkbox-date").checked,fields=check_fields?document.querySelector("#search-fields").value:"",date1=check_date?document.querySelector("#search-date1").value:"",date2=check_date?document.querySelector("#search-date2").value:"";init_data.post_data.name=fields,init_data.post_data.cate=`${customer}${SPLITER}${date1}${SPLITER}${date2}`,table_init(init_data),fetch_table()})),document.querySelector("#edit-button").addEventListener("click",(function(){let chosed=document.querySelector("tbody .focus"),id=chosed?chosed.querySelector("td:nth-child(3)").textContent:"";if(""!=id){let cate=chosed.querySelector("td:nth-child(4)").textContent,address=`/${code}/sale/`;-1!=cate.indexOf("采购")&&(address=`/${code}/buy_in/`),window.open(address+id)}else notifier.show("请先选择单据","danger")}));